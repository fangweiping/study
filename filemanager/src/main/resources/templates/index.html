<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head>    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>    <title>文件管理系统</title>    <!--图标样式-->    <link rel="stylesheet" type="text/css" href="../static/css/bootstrap.min.css"/>    <link rel="stylesheet" type="text/css" href="../static/css/zTreeStyle.css"/>    <script type="text/javascript" src="../static/js/jquery-1.7.2.min.js"></script>    <script type="text/javascript" src="../static/js/jquery.ztree.core.min.js"></script>    <script type="text/javascript" src="../static/js/jquery.ztree.excheck.min.js"></script>    <script type="text/javascript" src="../static/js/getParameter.js"></script>    <style type="text/css">        #right {            float: right;            width: 70%;            height: 839px;            border: 1px solid #bbbbbb;        }        #right_top {            margin: 10px 10px;            padding: 20px 20px;            border: 1px solid #bbbbbb;            height: 15%;        }        #right_bottom {            margin: 10px 10px;            border: 1px solid #bbbbbb;            height: 75%;        }        #right_top li {            display: inline-block;        }        #pageList {            text-align: center;        }        #pageList li {            display: inline-block;            margin-left: 10px;            margin-right: 10px;        }    </style>    <script type="text/javascript">    </script></head><body><div class="container-fluid" style="margin: 15px">    <div class="data_structure.tree well " id="ztree" style="width: 25%;height: 800px;display: inline-block">    </div>    <div id="right">        <div id="right_top">            <li>                <a class="btn btn-primary" onclick="createFolder()">创建文件夹</a>            </li>            <form id="from" style="display: inline-block;" enctype="multipart/form-data" method="post"                  action="http://localhost:8080/file">                <input type="hidden" name="pid"/>                <input type="file" name="file"/>                <input type="submit" class="btn btn-primary" value="上传文件" onclick="return uploadFile()"/>            </form>            <li>                <a class="btn btn-primary" onclick="deleteFile()">删除文件</a>            </li>            <li>                <a class="btn btn-primary" onclick="copyFile()">复制文件</a>            </li>        </div>        <div id="right_bottom">            <table class="table table-bordered" id="tab">                <tr>                    <td><input type="checkbox" id="selectAll"/></td>                    <td>文件名</td>                    <td>更新时间</td>                </tr>            </table>            <div class="pageNum">                <ul id="pageList">                </ul>            </div>        </div>    </div></div></body><script>    var treeNodes; //节点数据    var zTree; //树对象    var pId; //当前节点父id    var id; //当前节点id    var fileId; //文件id    var flag; //标记文件或文件夹是否存在    //获取分页参数    pId = getParameter("pId");    var page = getParameter("page");  //第几页    var rows = getParameter("rows");   //每页的行数    console.log("分页参数:" + "父ID:" + pId + "页码:" + page + "每页" + rows + "行");    //默认查看根目录    pId = pId ? pId : 0;    //默认查看第1页,每页10行    page = page ? page : 1;    rows = rows ? rows : 10;    //ztree参数设置    var setting = {        data: {            simpleData: {                enable: true,                idKey: "id",                pIdKey: "pId",                rootPId: 0            }        },        callback: {            onClick: zTreeOnClick        }    };    $(function () {        //设置为同步,确保初始化树之前完成数据加载        $.ajaxSettings.async = false        //发送ajax请求获取 treeNodes 数据        $.get("http://localhost:8080/folder/all", function (resp) {            console.log("resp"+JSON.stringify(resp));            if (resp) {                console.log(treeNodes);                console.log(resp.data);                treeNodes = resp.data;            }        }, "json");        //改回异步        $.ajaxSettings.async = true;        //初始化树        zTree = $.fn.zTree.init($("#ztree"), setting, treeNodes);        id = id ? id : 0;        //分页数据        getFileByPage(pId, page, rows);        console.log("父ID:" + pId + "  节点ID:" + id + "  文件ID:" + fileId);    });    //节点点击回调函数    function zTreeOnClick(event, treeId, treeNode) {        pId = treeNode.pId;        id = treeNode.id;        fileId = treeNode.fileId;        //每次点击节点,表示可能更换了目录,因此page重置为1        page = 1;        //获取分页数据        getFileByPage(id, page, rows);        console.log("父ID:" + pId + "  节点ID:" + id + "  文件ID:" + fileId);    };    //创建文件夹    function createFolder() {        //判断当前选中的节点是否为目录        if (pId && !id) {            alert("请选择正确的目录");            return;        }        //给节点id赋默认值        id = id ? id : 0;        var folderName = prompt("请输入文件夹名称");        //校验文件夹名        if (folderName) {            //调用函数校验是否重名            checkName("folder", id, folderName);            if (!flag) {                //新增文件夹                $.post("http://localhost:8080/folder/" + id + "/" + folderName, function (resp) {                }, "json");            }            console.log("取消文件夹的创建");            return;        } else {            alert("文件名不能为空,请重新输入!");        }    };    //文件上传    function uploadFile() {        //获取文件名        var filePath = $("input[type=file]").val();        var fileName = getFileName(filePath);        pId = pId ? pId : 0;        id = id ? id : 0;        console.log("将要上传的文件名:" + fileName);        //判断文件名是否为空        if (fileName) {            //重名校验            checkName("file", id, fileName);            //不重名            if (!flag) {                //给隐藏字段赋值                $("input[type=hidden]").val(id);                //提交表单                console.log("开始提交表单")                return true;            }            console.log("阻止表单提交")            return false;        }        alert("请选择一个文件!")        return false;    }    //重名校验    function checkName(type, pId, name) {        //发送请求校验数据是否重复        $.ajax({            url: "http://localhost:8080/" + type + "/" + id + "/" + name,    //请求的url地址            dataType: "json", //返回格式为json            async: false,   //默认为异步, false代表同步            type: "GET",   //请求方式            success: function (resp) {                //请求成功时处理                if (resp.exist) {                    alert(resp.msg);                    flag = true;                } else {                    flag = false;                }            }        });    };    //获取文件名    function getFileName(filePath) {        var index = filePath.lastIndexOf("\\");        return filePath.substring(index + 1);    }    //获取分页数据    function getFileByPage(pId, page, rows) {        console.log("查看第:" + page + "页,每页" + rows + "行");        $.ajax({            type: "get",            url: "http://localhost:8080/file/page",            data: {"pId": pId, "page": page, "rows": rows},            async: true,            dataType: "json",            success: function (resp) {                //分页数据渲染之前先清空                $("#tab").html("");                $("#pageList").html("");                var items = resp.items;//分页数据                var totalPage = resp.totalPage;//总页数                console.log("获取分页数据:" + JSON.stringify(items));                //将分页数据渲染到页面                var html = " <tr>\n" +                    "                <td><input  type=\"checkbox\" id=\"selectAll\"/><span>全选</span></td>\n" +                    "                <td>文件名</td>\n" +                    "                <td>更新时间</td>\n" +                    "            </tr>";                //拼接文件数据                $.each(items, function (index, element) {                    html += " <tr>\n" +                        "                <td><input type=\"checkbox\"/ value="+element.id+"></td>\n" +                        "                <td>" + element.name + "</td>\n" +                        "                <td>" + element.updateTime + "</td>\n" +                        "            </tr>";                    console.log(element);                });                //更新表格内容                $("#tab").html(html);                //分页栏                var pageBar;                //首页                console.log("当前目录ID:" + pId);                pageBar = "<li><a class='btn' href=\"./index.html?pId=" + pId + " \" >首页</a></li>";                //上一页                if (page != 1) {                    pageBar += "<li><a class='btn' href=\"./index.html?pId=" + pId + "&page=" + (parseInt(page) - 1) + "&rows=" + rows + " \" >上一页</a></li>";                } else {                    pageBar += "<li><a  class='btn' href='javascript:;'  >上一页</a></li>";                }                //循环拼接页码                for (var i = 1; i <= totalPage; i++) {                    pageBar += "<li><a class='btn' href=\"./index.html?pId=" + pId + "&page=" + i + "&rows=" + rows + " \" >" + i + "</a></li>";                }                //下一页                if (page != totalPage) {                    pageBar += "<li><a class='btn' href=\"./index.html?pId=" + pId + "&page=" + (parseInt(page) + 1) + "&rows=" + rows + " \" >下一页</a></li>";                } else {                    pageBar += "<li><a class='btn' href='javascript:;'  >下一页</a></li>";                }                //尾页                pageBar += "<li><a class='btn' href=\"./index.html?pId=" + pId + "&page=" + totalPage + "&rows=" + rows + " \" >尾页</a></li>";                //替换html                $("#pageList").html(pageBar);                console.log("分页数据渲染成功!");                //添加全选事件                $("#selectAll").click(function () {                    $("input[type=checkbox]").prop("checked", this.checked);                });            },            error: function (errorRes) { //请求失败执行的函数                //清空数据                $("#tab").html("");                $("#pageList").html("暂无数据");                console.log("分页数据请求失败:" + JSON.stringify(errorRes));            }        });    }    function copyFile() {    }</script></html>